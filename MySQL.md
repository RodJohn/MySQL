

基础架构

MySQL可以分为Server层和存储引擎层两部分

Server层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖MySQL的大多数核心服务功能

，以及所有的内置函数（如日期、时间、数学和加密函数等），

所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。

而存储引擎层负责数据的存储和提取。其

架构模式是插件式的，支持InnoDB、MyISAM、Memory等多个存储引擎。

现在最常用的存储引擎是InnoDB，它从MySQL 5.5.5版本开始成为了默认存储引擎。



查询语句内部的执行过程





# 连接器。

连接器负责跟客户端建立连接、获取权限、维持和管理连接

show processlist命令中看到


timeout


自动断开 不提示

 客户端如果太长时间没动静，连接器就会自动将它断开。这个时间是由参数wait_timeout控制的，默认值是8小时。
如果在连接被断开之后，客户端再次发送请求的话，就会收到一个错误提醒： Lost connection to MySQL server during query。

这时候如果你要继续，就需要重连，然后再执行请求了。

但是全部使用长连接后，

你可能会发现，有些时候MySQL占用内存涨得特别快，这是因为MySQL在执行过程中临时使用的内存是管理在连接对象里面的。

这些资源会在连接断开的时候才释放。所以如果长连接累积下来，可

能导致内存占用太大，被系统强行杀掉（OOM），从现象看就是MySQL异常重启了。


# 查询缓存

流程

命中
MySQL拿到一个查询请求后，会先到查询缓存看看，之前是不是执行过这条语句。

之前执行过的语句及其结果可能会以key-value对的形式，被直接缓存在内存中。
失效


查询缓存的失效非常频繁，只要有对一个表的更新，这个表上所有的查询缓存都会被清空。

不要使用查询缓存

MySQL 8.0版本直接将查询缓存的整块功能删掉了，也就是说8.0开始彻底没有这个功能了

# 分析器

因此需要对SQL语句做解析


# 优化器

优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序。


# 执行器

先判断一下你对这个表T有没有执行查询的权限



# 存储引擎

# 流程



执行器和存储引擎之间 



server binlog（归档日志）

innodb redo undo日志 





# 

不选择ALiSQL

    优化措施不一样











