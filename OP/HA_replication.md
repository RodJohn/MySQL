

双节点主从 + keepalived/heartbeat
一般来说，中小型规模的时候，采用这种架构是最省事的。
两个节点可以采用简单的一主一从模式，或者双主模式，并且放置于同一个VLAN中，
在master节点发生故障后，利用keepalived/heartbeat的高可用机制实现快速切换到slave节点。




4.基于Mysql主从复制(常用，普适)

备库，在线上也会提供服务，避免浪费；

而主从复制，也保证了数据不会丢失。



# 主从复制

MySQL主从复制是目前使用较为广泛的“读”高可用解决方案，
官方原生支持，技术比较成熟，配置也不复杂，
能够有效缓解数据库读写压力，

MySQL主从复制采用典型的Master-Slave架构，Slave从Master处同步数据来保证主从数据一致。
通过修改配置文件，可以设置同步粒度，如特定数据库，甚至是数据库中的某一张表。


流程

    binlog：Master进程，将数据更改写入二进制日志文件（Binary log）
    I/O：Slave进程，从Master服务器读取二进制日志文件，写入Slave的中继日志（Relay log）
    SQL：Slave进程，读取中继日志，执行其中的SQL语句


优点：

成本低，部署简单
可以作为一种备份机制，相当于热备份，保障数据安全
可以实现读写分离，Master上写数据，Slave上读数据，有效提高数据库读写性能
缺点：

Master可能出现单点故障问题，写数据仍然不是高可用
数据一致性问题（同步延迟）


# 双主复制

两台Master都可以读写，互为主备，
采用Keepalive等方案实现高可用（使用VIP对外提供服务），
默认只有一台（MasterA）负责数据写入，另一台（MasterB）备用。

优点

双主复制解决了主从复制的单点写故障问题，可以一定程度保障Master的高可用，
一台Master宕机后，可以在极短时间内自动切换到另一台Master。

通常会和proxy、keepalived等第三方软件同时使用，
即可以用来监控数据库的健康，又可以执行一系列管理命令。
如果主库发生故障，切换到备库后仍然可以继续使用数据库。

缺点：

资源利用率只有50%，高可用就是通过冗余实现，二者不可兼得
两台Master双写同步，数据可能冲突（如自增id同步冲突），需要解决冲突


# GTID    



MysqlProxy实现读写分离


























